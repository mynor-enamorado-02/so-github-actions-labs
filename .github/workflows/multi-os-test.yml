name: Multi-OS System Tests

on:
  workflow_dispatch:
    inputs:
      test-mode:
        description: 'Modo de prueba'
        required: true
        default: 'full'
        type: choice
        options:
          - quick
          - full
          - debug
  push:
    branches: [ main, master ]

jobs:
  ubuntu-test:
    runs-on: ubuntu-latest
    name: Ubuntu Linux Tests
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Mostrar informaci√≥n de ejecuci√≥n
      if: ${{ github.event_name == 'workflow_dispatch' }}
      run: |
        echo "üöÄ EJECUCI√ìN MANUAL - UBUNTU"
        echo "=============================="
        echo "Usuario: ${{ github.actor }}"
        echo "Modo: ${{ github.event.inputs.test-mode }}"
        echo "Hora: $(date)"
        echo ""
    
    - name: Informaci√≥n del sistema Ubuntu
      run: |
        echo "üñ•Ô∏è  INFORMACI√ìN DEL SISTEMA UBUNTU"
        echo "====================================="
        echo "Versi√≥n del SO:"
        lsb_release -a
        echo ""
        echo "Arquitectura: $(uname -m)"
        echo "Kernel: $(uname -r)"
        echo ""
        echo "Variables de entorno importantes:"
        echo "HOME: $HOME"
        echo "USER: $USER"
        echo "PATH: $PATH" | tr ':' '\n' | head -5
        echo ""
    
    - name: Comandos espec√≠ficos Linux
      run: |
        echo "üíª COMANDOS ESPEC√çFICOS LINUX"
        echo "=============================="
        echo "1. Espacio en disco:"
        df -h
        echo ""
        echo "2. Memoria disponible:"
        free -h
        echo ""
        echo "3. Procesos activos (top 3):"
        ps aux --sort=-%cpu | head -4
        echo ""
        echo "4. Paquetes instalados (ejemplo):"
        dpkg -l | grep -E "git|curl|wget" | head -5

  windows-test:
    runs-on: windows-latest
    name: Windows Tests
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Mostrar informaci√≥n de ejecuci√≥n
      if: ${{ github.event_name == 'workflow_dispatch' }}
      run: |
        Write-Host "üöÄ EJECUCI√ìN MANUAL - WINDOWS" -ForegroundColor Green
        Write-Host "==============================" -ForegroundColor Green
        Write-Host "Usuario: ${{ github.actor }}"
        Write-Host "Modo: ${{ github.event.inputs.test-mode }}"
        Write-Host "Hora: $(Get-Date -Format 'HH:mm:ss')"
        Write-Host ""
    
    - name: Informaci√≥n del sistema Windows
      run: |
        Write-Host "üñ•Ô∏è  INFORMACI√ìN DEL SISTEMA WINDOWS" -ForegroundColor Cyan
        Write-Host "======================================" -ForegroundColor Cyan
        Write-Host "Informaci√≥n del sistema:"
        systeminfo | Select-String -Pattern "OS Name","OS Version","System Type","System Boot Time" -CaseSensitive:$false
        Write-Host ""
        Write-Host "Arquitectura:"
        if ([Environment]::Is64BitOperatingSystem) { "x64" } else { "x86" }
        Write-Host ""
        Write-Host "Variables de entorno importantes:"
        Write-Host "USERNAME: $env:USERNAME"
        Write-Host "COMPUTERNAME: $env:COMPUTERNAME"
        Write-Host "PATH (primeras 3 rutas):"
        $env:PATH -split ';' | Select-Object -First 3
        Write-Host ""
    
    - name: Comandos espec√≠ficos Windows PowerShell
      run: |
        Write-Host "üíª COMANDOS ESPEC√çFICOS WINDOWS" -ForegroundColor Yellow
        Write-Host "=================================" -ForegroundColor Yellow
        Write-Host "1. Espacio en disco:"
        Get-PSDrive C | Format-List Used,Free,Size
        Write-Host ""
        Write-Host "2. Informaci√≥n de procesos (top 3):"
        Get-Process | Sort-Object CPU -Descending | Select-Object -First 3 ProcessName,CPU,WorkingSet
        Write-Host ""
        Write-Host "3. Servicios en ejecuci√≥n (ejemplos):"
        Get-Service | Where-Object {$_.Status -eq 'Running'} | Select-Object -First 3 DisplayName,Status
        Write-Host ""
        Write-Host "4. Informaci√≥n de red:"
        Get-NetIPConfiguration | Select-Object InterfaceAlias,IPv4Address

  macos-test:
    runs-on: macos-latest
    name: macOS Tests
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Mostrar informaci√≥n de ejecuci√≥n
      if: ${{ github.event_name == 'workflow_dispatch' }}
      run: |
        echo "üöÄ EJECUCI√ìN MANUAL - macOS"
        echo "=============================="
        echo "Usuario: ${{ github.actor }}"
        echo "Modo: ${{ github.event.inputs.test-mode }}"
        echo "Hora: $(date)"
        echo ""
    
    - name: Informaci√≥n del sistema macOS
      run: |
        echo "üñ•Ô∏è  INFORMACI√ìN DEL SISTEMA macOS"
        echo "===================================="
        echo "Versi√≥n del sistema:"
        sw_vers
        echo ""
        echo "Arquitectura: $(uname -m)"
        echo "Nombre del host: $(hostname)"
        echo ""
        echo "Informaci√≥n del hardware:"
        system_profiler SPHardwareDataType | grep -E "Model Name|Chip|Memory|Serial Number" | head -5
        echo ""
        echo "Variables de entorno importantes:"
        echo "HOME: $HOME"
        echo "USER: $USER"
        echo "SHELL: $SHELL"
    
    - name: Comandos espec√≠ficos macOS
      run: |
        echo "üíª COMANDOS ESPEC√çFICOS macOS"
        echo "================================"
        echo "1. Espacio en disco:"
        df -h
        echo ""
        echo "2. Memoria disponible:"
        top -l 1 -s 0 | grep PhysMem
        echo ""
        echo "3. Procesos activos (top 3):"
        ps aux | sort -nrk 3,3 | head -4
        echo ""
        echo "4. Informaci√≥n de red:"
        networksetup -listallhardwareports | head -10

  resultados:
    runs-on: ubuntu-latest
    name: üìä Resumen de Resultados
    needs: [ubuntu-test, windows-test, macos-test]
    
    steps:
    - name: Generar resumen
      run: |
        echo "=========================================="
        echo "         üìã RESUMEN DE EJECUCI√ìN"
        echo "=========================================="
        echo ""
        echo "‚úÖ Todas las pruebas se completaron exitosamente"
        echo ""
        echo "Sistemas probados:"
        echo "  ‚Ä¢ ‚úÖ Ubuntu Linux (ubuntu-latest)"
        echo "  ‚Ä¢ ‚úÖ Windows Server (windows-latest)"
        echo "  ‚Ä¢ ‚úÖ macOS (macos-latest)"
        echo ""
        echo "Modo de ejecuci√≥n: ${{ github.event_name }}"
        echo ""
        echo "Hora de finalizaci√≥n: $(date)"
        echo "=========================================="
